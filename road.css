// ===== Car scroll animation =====
const car = document.getElementById("car");

function updateCar() {
  const doc = document.documentElement;
  const scrollTop = doc.scrollTop || document.body.scrollTop;
  const scrollHeight = doc.scrollHeight - doc.clientHeight;
  const progress = scrollHeight > 0 ? (scrollTop / scrollHeight) : 0;

  // Car moves from ~82% (start) to ~20% (near top) as you scroll down
  const start = 82;
  const end = 20;
  const y = start + (end - start) * progress;

  // small ‚Äúwobble‚Äù left-right so it feels alive
  const wobble = Math.sin(progress * Math.PI * 10) * 2.5; // px
  car.style.top = `${y}%`;
  car.style.transform = `translate(-50%, -50%) translateX(${wobble}px)`;
}

window.addEventListener("scroll", updateCar, { passive: true });
window.addEventListener("resize", updateCar);
updateCar();

// ===== NOW panel story & logic =====
const nowText = document.getElementById("nowText");
const nowNext = document.getElementById("nowNext");
const questionButtons = document.getElementById("questionButtons");
const threeYesRow = document.getElementById("threeYesRow");
const yesBtn = document.getElementById("yesBtn");
const twoYesBtn = document.getElementById("twoYesBtn");
const threeYesBtn = document.getElementById("threeYesBtn");
const result = document.getElementById("result");
const toFuture = document.getElementById("toFuture");

const steps = [
  "Die letzten 3,5 Monate mit dir waren die sch√∂nsten in meinem Leben.",
  "Unser erstes Weihnachten liegt hinter uns‚Ä¶ und jetzt steht Valentinstag vor der T√ºr.",
  "M√∂chtest du mein Valentinstags-Date sein? üíê"
];

let stepIndex = 0;
let locked = false;

function renderStep() {
  nowText.textContent = steps[stepIndex];

  // Default state
  result.textContent = "";
  toFuture.classList.add("hidden");
  threeYesRow.classList.add("hidden");

  if (stepIndex < steps.length - 1) {
    questionButtons.classList.add("hidden");
    nowNext.classList.remove("hidden");
    nowNext.textContent = "Weiter ‚Üì";
  } else {
    // Question step
    nowNext.classList.add("hidden");
    questionButtons.classList.remove("hidden");
  }
}

nowNext.addEventListener("click", () => {
  if (locked) return;
  stepIndex = Math.min(stepIndex + 1, steps.length - 1);
  renderStep();
});

function hearts(count = 24) {
  for (let i = 0; i < count; i++) {
    const h = document.createElement("div");
    h.className = "heart";
    h.textContent = "üíñ";
    h.style.position = "fixed";
    h.style.left = `${Math.random() * (window.innerWidth - 20)}px`;
    h.style.top = `${window.innerHeight - 50}px`;
    h.style.fontSize = `${14 + Math.random() * 18}px`;
    h.style.pointerEvents = "none";
    h.style.zIndex = "9999";
    h.style.transition = "transform 1.4s ease-out, opacity 1.4s ease-out";
    document.body.appendChild(h);

    requestAnimationFrame(() => {
      h.style.transform = `translateY(-160px) scale(${1.1 + Math.random() * 0.5})`;
      h.style.opacity = "0";
    });

    setTimeout(() => h.remove(), 1400);
  }
}

function acceptYes() {
  locked = true;
  questionButtons.classList.add("hidden");
  result.textContent = "Dann halt dir den 14.02. frei ‚Äî weitere Infos kommen üíå";
  hearts(30);
  toFuture.classList.remove("hidden");
}

function acceptTwoYes() {
  // show 3√ó Yes
  result.textContent = "Okay‚Ä¶ aber nur wenn du es wirklich meinst üòÑ";
  hearts(14);
  threeYesRow.classList.remove("hidden");
}

function acceptThreeYes() {
  locked = true;
  threeYesRow.classList.add("hidden");
  result.textContent = "Ich liebe dich ‚ù§Ô∏è Und halt dir den 14.02. frei ‚Äî weitere Infos kommen üíå";
  hearts(36);
  toFuture.classList.remove("hidden");
}

yesBtn.addEventListener("click", acceptYes);
twoYesBtn.addEventListener("click", acceptTwoYes);
threeYesBtn.addEventListener("click", acceptThreeYes);

// Initialize NOW text
renderStep();

// ===== Countdown (next Feb 14) =====
const cdDays = document.getElementById("cdDays");
const cdHours = document.getElementById("cdHours");
const cdMins = document.getElementById("cdMins");
const cdSecs = document.getElementById("cdSecs");
const cdTarget = document.getElementById("cdTarget");

function nextValentinesDate() {
  const now = new Date();
  const year = now.getFullYear();

  // Target: Feb 14, 00:00 local time (you can change to 18:00 if you want)
  let target = new Date(year, 1, 14, 0, 0, 0); // month is 0-based; 1 = Feb
  if (now > target) target = new Date(year + 1, 1, 14, 0, 0, 0);
  return target;
}

let target = nextValentinesDate();

function pad2(n) {
  return String(n).padStart(2, "0");
}

function updateCountdown() {
  const now = new Date();
  const diff = target - now;

  if (diff <= 0) {
    cdDays.textContent = "0";
    cdHours.textContent = "00";
    cdMins.textContent = "00";
    cdSecs.textContent = "00";
    cdTarget.textContent = "Es ist Valentinstag! üíò";
    return;
  }

  const totalSeconds = Math.floor(diff / 1000);
  const days = Math.floor(totalSeconds / (24 * 3600));
  const hours = Math.floor((totalSeconds % (24 * 3600)) / 3600);
  const mins = Math.floor((totalSeconds % 3600) / 60);
  const secs = totalSeconds % 60;

  cdDays.textContent = String(days);
  cdHours.textContent = pad2(hours);
  cdMins.textContent = pad2(mins);
  cdSecs.textContent = pad2(secs);

  cdTarget.textContent = `Ziel: ${target.toLocaleDateString("de-DE")} üíò`;
}

updateCountdown();
setInterval(updateCountdown, 1000);
